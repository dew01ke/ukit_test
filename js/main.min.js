'use strict';var _extends=Object.assign||function(c){for(var g,d=1;d<arguments.length;d++)for(var h in g=arguments[d],g)Object.prototype.hasOwnProperty.call(g,h)&&(c[h]=g[h]);return c};(function(){var d={hash:{guid:function guid(){function o(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return o()+o()+'-'+o()+'-'+o()+'-'+o()+'-'+o()+o()+o()}},text:{toLower:function toLower(o){return o.toString().toLowerCase()},truncate:function truncate(o,p){var q=o.toString();return q.length>p?q.substring(0,p)+'...':q}},time:{getTimestamp:function getTimestamp(){return new Date().getTime()}},validation:{isLikeInteger:function isLikeInteger(o){return /^\d+$/.test(o)}},escape:{getText:function getText(o){var p={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'};return(o+'').replace(/[&<>"'`=\/]/g,function(q){return p[q]})}}},g=function(){var o=this,p={modal:'\n            <div class="overlay">\n                <div class="modal">\n                    <div class="modal-header">{title}</div>\n                        <div class="modal-content">\n                            <p>{text}</p>\n                        </div>\n                        <div class="modal-bottom">\n                            {buttons}\n                        </div>\n                </div>\n            </div>\n        ',modal_button:'\n            <button id="{id}" class="modal-button {color} {type}">{text}</button>\n        ',book:'\n        <div class="book">\n            <div class="book-author">{author}</div>\n            <div class="book-name">{name}</div>\n            <div class="book-controls">\n                <button class="book-button-edit button icon icon-edit"></button>\n                <button class="book-button-remove button icon icon-remove"></button>\n            </div>\n        </div>\n        '};o.set=function(q,r){p[q]=r},o.get=function(q){return p.hasOwnProperty(q)?p[q]:''},o.fill=function(q,r){var s='';if(p.hasOwnProperty(q))for(var u in s=p[q],r)r.hasOwnProperty(u)&&(s=s.replace(new RegExp('{'+u+'}','g'),r[u]));return s}},h=function(){var o=this,p={},q=!1,r='ukit_test'+'_storage';o.isLocalStorageAvailable=function(){try{return window.localStorage.setItem(r+'_test','test'),window.localStorage.removeItem(r+'_test'),!0}catch(s){return!1}},o.init=function(){return q=o.isLocalStorageAvailable(),o},o.set=function(s,u){p[s]=u,q&&window.localStorage.setItem(r,JSON.stringify(p))},o.get=function(s){if(q){var u=window.localStorage.getItem(r);try{if(u=JSON.parse(u),u.hasOwnProperty(s))return u[s]}catch(w){}return null}return p.hasOwnProperty(s)?p[s]:null},o.all=function(){if(q){var s=window.localStorage.getItem(r);try{return s=JSON.parse(s),s}catch(u){}return{}}return p},o.remove=function(s){p.hasOwnProperty(s)&&delete p[s],q&&window.localStorage.setItem(r,JSON.stringify(p))},o.flush=function(){p={},q&&window.localStorage.removeItem(r)}},k=function(){var o=this;o.sendCustomEvent=function(p,q,r){var s=new CustomEvent(p,{detail:q?q:null,bubbles:!0,cancelable:!0});r?r.dispatchEvent(s):document.dispatchEvent(s)}},l=function(){var o=this;o.createElement=function(p){var q=document.createElement('div');return q.innerHTML=p.trim(),q.firstChild},o.find=function(p,q){var r=q?q.querySelectorAll(p):document.querySelectorAll(p);return r&&r.length?r:[]},o.attr=function(p,q,r){return!!p&&(r?p.setAttribute(q,r):p.getAttribute(q))},o.addClass=function(p,q){return p&&p.classList&&p.classList.add(q)},o.removeClass=function(p,q){return p&&p.classList&&p.classList.remove(q)},o.hasClass=function(p,q){return p&&p.classList&&p.classList.contains(q)},o.show=function(p){return!!p&&o.attr(p,'style','display: block;')},o.hide=function(p){return!!p&&o.attr(p,'style','display: none;')},o.removeWithAnimation=function(p,q,r){p&&(o.addClass(p,q),setTimeout(function(){p.remove(),r&&r()},400))}},m=function(){var o=this;o.isIntValid=function(p,q,r){if(d.validation.isLikeInteger(p)){var s=parseInt(p),u=q&&parseInt(q)?parseInt(q):null,w=r&&parseInt(r)?parseInt(r):null;if(s){if(u&&u>p)return!1;if(w&&p>w)return!1}else return!1}else return!1;return!0},o.isStringValid=function(p,q,r){if(p){var s=p.trim(),u=q&&parseInt(q)?parseInt(q):null,w=r&&parseInt(r)?parseInt(r):null;if(u&&u>s.length)return!1;if(w&&s.length>w)return!1}else return!1;return!0},o.isValid=function(p,q){if(p&&q){if('string'===q.type)return o.isStringValid(p.value,q.min,q.max);return!('int'!==q.type)&&o.isIntValid(p.value,q.min,q.max)}}},n=function(){function o(B){var C=B.target,D=z.attr(C,'data-v-type'),E=z.attr(C,'data-v-min'),F=z.attr(C,'data-v-max'),G=A.isValid(C,{type:D,min:E,max:F});return G?z.removeClass(C,'sidebar-input-error'):z.addClass(C,'sidebar-input-error'),G}function p(B){if(z.hasClass(B.target,'book-button-edit')&&y.sendCustomEvent('EVENT_BOOK_EDIT',{from:'handler'},B.target),z.hasClass(B.target,'book-button-remove')&&y.sendCustomEvent('EVENT_BOOK_REMOVE',{from:'handler'},B.target),'sidebar-count-inc'===z.attr(B.target,'id')&&(s.methods.countValueIncrease(1),o({target:u.elements.input_count})),'sidebar-count-dec'===z.attr(B.target,'id')&&(s.methods.countValueIncrease(-1),o({target:u.elements.input_count})),'sidebar-button-revert'===z.attr(B.target,'id')&&s.methods.setDefaultSidebar(),'sidebar-button-save'===z.attr(B.target,'id')){var C=u.editable;s.methods.saveBook({parent:u.books[C].parent,name:u.elements.input_name.value,author:u.elements.input_author.value,date:u.elements.input_date.value,count:u.elements.input_count.value},u.editable,!0)}if('sidebar-button-create'===z.attr(B.target,'id')&&s.methods.createBook({name:u.elements.input_name.value,author:u.elements.input_author.value,date:u.elements.input_date.value,count:u.elements.input_count.value},!0),'content-top-sort-name'===z.attr(B.target,'id')&&(B.preventDefault(),Object.keys(u.books).length)){var D=z.attr(B.target,'data-s-type')||'0',E=Object.keys(u.books).map(function(G){return u.books[G]}),F=-1;q(!0),'0'===D?(z.attr(B.target,'data-s-type','1'),F=-1):'1'===D?(z.attr(B.target,'data-s-type','2'),F=1):'2'===D&&(z.attr(B.target,'data-s-type','0'),F=0),F?E.sort(function(G,H){return G.name===H.name?0:G.name<H.name?F:-1*F}).forEach(function(G){u.elements.books.appendChild(G.parent)}):E.forEach(function(G){u.elements.books.appendChild(G.parent)})}}function q(B){var C=z.find('.book-search-hidden');for(var D in C)C.hasOwnProperty(D)&&z.removeClass(C[D],'book-search-hidden');B&&(u.elements.content_search_input.value='')}function r(B){if(!!B){for(var D in u.books)if(u.books.hasOwnProperty(D)){var E=d.text.toLower(u.books[D].name),F=d.text.toLower(B);0<=E.indexOf(F)?z.removeClass(u.books[D].parent,'book-search-hidden'):z.addClass(u.books[D].parent,'book-search-hidden')}}else q()}var s=this,u={elements:{},books:{},modal:null,editable:null},w=new g,x=new h().init(),y=new k,z=new l,A=new m;s.init=function(){s.methods.initElementsCache();var B=x.all();if(B)for(var C in B)B.hasOwnProperty(C)&&s.methods.createBook(B[C],!1);return document.addEventListener('click',p),u.elements.input_name.addEventListener('keyup',o),u.elements.input_author.addEventListener('keyup',o),u.elements.input_date.addEventListener('keyup',o),u.elements.input_count.addEventListener('keyup',o),u.elements.content_search_input&&u.elements.content_search_input.addEventListener('keyup',function(D){r(this.value,D)}),s},s.methods={initElementsCache:function initElementsCache(){u.elements={sidebar:z.find('#sidebar')[0],sidebar_revert:z.find('#sidebar-button-revert')[0],sidebar_save:z.find('#sidebar-button-save')[0],sidebar_create:z.find('#sidebar-button-create')[0],input_name:z.find('#input-name')[0],input_author:z.find('#input-author')[0],input_date:z.find('#input-date')[0],input_count:z.find('#input-count')[0],content:z.find('#content')[0],books:z.find('#books')[0],content_search_input:z.find('#content-top-search-input')[0],content_sort_name:z.find('#content-top-sort-name')[0],content_empty:z.find('#content-empty')[0],count_inc:z.find('#sidebar-count-inc')[0],count_dec:z.find('#sidebar-count-dec')[0]}},countValueIncrease:function countValueIncrease(B){var C=u.elements.input_count.value,D=parseInt(C);d.validation.isLikeInteger(C)?0<=D+B&&(u.elements.input_count.value=D+B):u.elements.input_count.value=(D?D:0)+B},checkInputValidation:function checkInputValidation(){var B=o({target:u.elements.input_name}),C=o({target:u.elements.input_author}),D=o({target:u.elements.input_date}),E=o({target:u.elements.input_count});return B&&C&&D&&E||(s.methods.showModal({title:'\u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435',text:'\u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435, \u043F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0444\u043E\u0440\u043C\u0443 \u043D\u0430 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E\u0441\u0442\u044C \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u043D\u044B\u0445 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438 \u0438\u0441\u043F\u0440\u0430\u0432\u044C\u0442\u0435 \u043D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u044B\u0435 \u043F\u043E\u043B\u044F (\u043E\u0431\u043E\u0437\u043D\u0430\u0447\u0435\u043D\u044B \u043A\u0440\u0430\u0441\u043D\u044B\u043C \u0446\u0432\u0435\u0442\u043E\u043C).',buttons:[{type:'modal-button-1',text:'\u0425\u043E\u0440\u043E\u0448\u043E',onClick:function onClick(F){F.modal.close()}}]}),!1)},showModal:function showModal(B){function C(){D&&(D.remove(),u.modal=null)}if(!B)return!1;u.modal&&u.modal.close();var D=null,E='';for(var F in B.buttons)B.buttons.hasOwnProperty(F)&&(E+=w.fill('modal_button',{id:'modal-button-'+F,color:B.buttons[F].color,type:B.buttons[F].type,text:B.buttons[F].text}));var G=w.fill('modal',{title:B.title,text:B.text,buttons:E}),H=z.find('body')[0];if(H){D=z.createElement(G),D.className='overlay',H.appendChild(D);var I={element:D,close:function close(){C()}};return D.addEventListener('click',function(J){for(var K in this===J.target&&C(),B.buttons)B.buttons.hasOwnProperty(K)&&B.buttons[K].hasOwnProperty('onClick')&&J.target===z.find('#modal-button-'+K)[0]&&(J.modal=I,B.buttons[K].onClick(J))}),u.modal=I,I}},createBook:function createBook(B,C){if(B){if(C&&!s.methods.checkInputValidation())return!1;var D=d.hash.guid(),E=w.fill('book',{name:d.text.truncate(d.escape.getText(B.name),35),author:d.text.truncate(d.escape.getText(B.author),75)}),F=z.createElement(E);F.addEventListener('EVENT_BOOK_EDIT',function(H){H.stopPropagation(),z.removeClass(u.elements.input_name,'sidebar-input-error'),z.removeClass(u.elements.input_author,'sidebar-input-error'),z.removeClass(u.elements.input_date,'sidebar-input-error'),z.removeClass(u.elements.input_count,'sidebar-input-error'),s.methods.editBook(u.books[D])}),F.addEventListener('EVENT_BOOK_REMOVE',function(H){H.stopPropagation();var I=u.books[D];s.methods.showModal({title:'\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435',text:'\u0412\u044B \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u044C\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C <b>\xAB'+I.name+'\xBB</b> \u043E\u0442 <b>'+I.author+'</b>?',buttons:[{type:'modal-button-2',text:'\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C',onClick:function onClick(J){J.modal.close()}},{type:'modal-button-2',color:'button-red',text:'\u0423\u0434\u0430\u043B\u0438\u0442\u044C',onClick:function onClick(J){z.removeWithAnimation(I.parent,'animation-fade-out',function(){x.remove(D),delete u.books[D],s.methods.checkIfBooksEmpty()}),J.modal.close()}}]})});var G=_extends({},B,{id:D,updated_at:d.time.getTimestamp(),created_at:d.time.getTimestamp()});u.books[D]=_extends({},G,{parent:F}),u.elements.books.appendChild(F),x.set(D,G),s.methods.setDefaultSidebar(),s.methods.checkIfBooksEmpty()}},saveBook:function saveBook(B,C,D){if(B){if(D&&!s.methods.checkInputValidation())return!1;if(u.books.hasOwnProperty(C)){var E=z.find('.book-name',B.parent)[0],F=z.find('.book-author',B.parent)[0];if(E&&F){E.innerHTML=d.text.truncate(d.escape.getText(B.name),35),F.innerHTML=d.text.truncate(d.escape.getText(B.author),75),u.books[C].name=d.escape.getText(B.name),u.books[C].author=d.escape.getText(B.author),u.books[C].date=B.date,u.books[C].count=B.count,u.books[C].updated_at=d.time.getTimestamp();var G=u.books[C];delete G.parent,x.set(C,G)}}s.methods.setDefaultSidebar(),s.methods.checkIfBooksEmpty()}},editBook:function editBook(B){if(B){z.addClass(u.elements.sidebar,'sidebar-editable'),u.elements.input_name.value=B.name,u.elements.input_author.value=B.author,u.elements.input_date.value=B.date,u.elements.input_count.value=B.count;var C=z.find('.book-editable')[0];C&&z.removeClass(C,'book-editable'),u.editable=B.id,z.addClass(B.parent,'book-editable')}},checkIfBooksEmpty:function checkIfBooksEmpty(){Object.keys(u.books).length?(z.hide(u.elements.content_empty),z.show(u.elements.books)):(z.hide(u.elements.books),z.show(u.elements.content_empty))},setDefaultSidebar:function setDefaultSidebar(){u.editable=null,u.elements.input_name.value='',u.elements.input_author.value='',u.elements.input_date.value='',u.elements.input_count.value='';var B=z.find('.book-editable')[0];B&&z.removeClass(B,'book-editable'),z.removeClass(u.elements.sidebar,'sidebar-editable')}}};document.addEventListener('DOMContentLoaded',function(){var o=new n().init(),p=0<=window.location.search.indexOf('test=1');p&&(o.methods.createBook({name:'\u0412\u043E\u0439\u043D\u0430 \u0438 \u043C\u0438\u0440',author:'\u041B\u0435\u0432 \u0422\u043E\u043B\u0441\u0442\u043E\u0439',date:1869,count:1869}),o.methods.createBook({name:'1984',author:'\u0414\u0436\u043E\u0440\u0434\u0436 \u041E\u0440\u0443\u044D\u043B\u043B',date:1949,count:1949}),o.methods.createBook({name:'\u041A\u0435\u043D\u0442\u0435\u0440\u0431\u0435\u0440\u0438\u0439\u0441\u043A\u0438\u0435 \u0440\u0430\u0441\u0441\u043A\u0430\u0437\u044B',author:'\u0414\u0436\u043E\u0444\u0444\u0440\u0438 \u0427\u043E\u0441\u0435\u0440',date:1813,count:1813}),o.methods.createBook({name:'\u041B\u0435\u0432, \u043A\u043E\u043B\u0434\u0443\u043D\u044C\u044F \u0438 \u043F\u043B\u0430\u0442\u044F\u043D\u043E\u0439 \u0448\u043A\u0430\u0444',author:'\u041A\u043B\u0430\u0439\u0432 \u041B\u044C\u044E\u0438\u0441',date:1950,count:1950}),o.methods.createBook({name:'\u0414\u0436\u043E\u043D \u041A\u0435\u0439\u043D\u0441',author:'\u041E\u0431\u0449\u0430\u044F \u0442\u0435\u043E\u0440\u0438\u044F \u0437\u0430\u043D\u044F\u0442\u043E\u0441\u0442\u0438, \u043F\u0440\u043E\u0446\u0435\u043D\u0442\u0430 \u0438 \u0434\u0435\u043D\u0435\u0433',date:1936,count:1936}),o.methods.createBook({name:'\u041B\u0435\u0432 \u0422\u043E\u043B\u0441\u0442\u043E\u0439',author:'\u0410\u043D\u043D\u0430 \u041A\u0430\u0440\u0435\u043D\u0438\u043D\u0430',date:1877,count:1877}))})})();